{% extends 'base.html' %}
{% load static %}

{% block title %}Contact Us - Event Platform{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-12">
    <div class="max-w-3xl mx-auto">
        <h1 class="text-4xl font-bold mb-8">Contact Us</h1>
        
        <div id="contact-form-container">
            {% if messages %}
                {% for message in messages %}
                    <div class="{% if message.tags == 'success' %}bg-green-100 border border-green-400 text-green-700{% else %}bg-red-100 border border-red-400 text-red-700{% endif %} px-4 py-3 rounded mb-4" role="alert">
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
            
            <div class="bg-white shadow-sm rounded-lg p-6">
                <form method="POST" id="contact-form" class="space-y-6">
                    {% csrf_token %}
                    <div>
                        <label for="name" class="block text-sm font-medium text-gray-700">Name</label>
                        <input type="text" name="name" id="name" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                    </div>
                    <div>
                        <label for="email" class="block text-sm font-medium text-gray-700">Email</label>
                        <input type="email" name="email" id="email" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                    </div>
                    <div>
                        <label for="subject" class="block text-sm font-medium text-gray-700">Subject</label>
                        <input type="text" name="subject" id="subject" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                    </div>
                    <div>
                        <label for="message" class="block text-sm font-medium text-gray-700">Message</label>
                        <textarea name="message" id="message" rows="4" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"></textarea>
                    </div>
                    <div>
                        <button type="submit" id="submit-btn" class="inline-flex justify-center rounded-md border border-transparent bg-indigo-600 py-2 px-4 text-sm font-medium text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2">
                            Send Message
                        </button>
                        <span id="form-loader" class="hidden ml-3">
                            <svg class="animate-spin h-5 w-5 text-indigo-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                        </span>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('contact-form');
    const submitBtn = document.getElementById('submit-btn');
    const loader = document.getElementById('form-loader');
    
    form.addEventListener('submit', function(e) {
        e.preventDefault();
        
        // Show loader
        submitBtn.disabled = true;
        loader.classList.remove('hidden');
        
        // Get form data
        const formData = new FormData(form);
        
        // Send ajax request
        fetch('{% url "contact" %}', {
            method: 'POST',
            body: formData,
            headers: {
                'X-Requested-With': 'XMLHttpRequest',
            }
        })
        .then(response => response.json())
        .then(data => {
            // Hide loader
            submitBtn.disabled = false;
            loader.classList.add('hidden');
            
            if (data.success) {
                // Show success message
                const successMsg = document.createElement('div');
                successMsg.classList.add('bg-green-100', 'border', 'border-green-400', 'text-green-700', 'px-4', 'py-3', 'rounded', 'mb-4');
                successMsg.textContent = data.message;
                
                const container = document.getElementById('contact-form-container');
                container.insertBefore(successMsg, form);
                
                // Reset form
                form.reset();
            } else {
                // Show error message
                const errorMsg = document.createElement('div');
                errorMsg.classList.add('bg-red-100', 'border', 'border-red-400', 'text-red-700', 'px-4', 'py-3', 'rounded', 'mb-4');
                errorMsg.textContent = data.message || 'An error occurred. Please try again.';
                
                const container = document.getElementById('contact-form-container');
                container.insertBefore(errorMsg, form);
            }
        })
        .catch(error => {
            // Hide loader
            submitBtn.disabled = false;
            loader.classList.add('hidden');
            
            // Show error message
            const errorMsg = document.createElement('div');
            errorMsg.classList.add('bg-red-100', 'border', 'border-red-400', 'text-red-700', 'px-4', 'py-3', 'rounded', 'mb-4');
            errorMsg.textContent = 'An error occurred. Please try again.';
            
            const container = document.getElementById('contact-form-container');
            container.insertBefore(errorMsg, form);
        });
    });
});
</script>
{% endblock %}
